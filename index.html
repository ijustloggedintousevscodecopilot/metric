<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .conversion-tab {
            transition: all 0.2s ease;
        }
        
        .conversion-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .unit-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .unit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .result-display {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .favorite-btn.active {
            color: #fbbf24;
        }
        
        .swipe-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .search-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        /* Custom Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* Firefox scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        
        .dark * {
            scrollbar-color: #6b7280 #374151;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 transition-colors">
        <div class="max-w-md mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-semibold text-gray-800 dark:text-white transition-colors">Unit Converter</h1>
                <div class="flex items-center space-x-2">
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors relative">
                        <svg class="w-5 h-5 moon-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                        <svg class="w-5 h-5 sun-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </button>
                    <button id="shareBtn" class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="mt-4 relative">
                <input type="text" id="searchInput" placeholder="Search units..." 
                       class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                <svg class="w-5 h-5 text-gray-400 dark:text-gray-500 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-md mx-auto px-4 py-6">
        <!-- Conversion Categories Tabs -->
        <div class="mb-6">
            <div class="flex space-x-1 bg-gray-200 dark:bg-gray-700 p-1 rounded-lg overflow-x-auto">
                <button class="conversion-tab active px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="length">Length</button>
                <button class="conversion-tab px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="weight">Weight</button>
                <button class="conversion-tab px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="temperature">Temp</button>
                <button class="conversion-tab px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="volume">Volume</button>
                <button class="conversion-tab px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="time">Time</button>
                <button class="conversion-tab px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="digital">Digital</button>
                <button class="conversion-tab px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap" data-category="scientific">Scientific</button>
            </div>
        </div>

        <!-- Input Section -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 mb-6 transition-colors">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">From</label>
                    <div class="relative">
                        <input type="number" id="fromValue" placeholder="Enter value" 
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                        <select id="fromUnit" class="absolute right-2 top-2 bottom-2 px-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></select>
                    </div>
                </div>
                
                <div class="flex justify-center">
                    <button id="swapBtn" class="p-2 text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                        </svg>
                    </button>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">To</label>
                    <div class="relative">
                        <input type="text" id="toValue" readonly 
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-600 result-display text-lg font-semibold">
                        <select id="toUnit" class="absolute right-2 top-2 bottom-2 px-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></select>
                        <button id="favoriteBtn" class="absolute left-2 top-2.5 p-1 text-gray-400 dark:text-gray-500 hover:text-yellow-400 transition-colors favorite-btn">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Conversion Cards -->
        <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Quick Conversions</h3>
                <div class="flex items-center space-x-1 text-gray-400 dark:text-gray-500 text-xs swipe-indicator">
                    <span>Swipe</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
            </div>
            <div id="quickCards" class="flex space-x-3 overflow-x-auto pb-2">
                <!-- Quick conversion cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Favorites Section -->
        <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-medium text-gray-700">Favorites</h3>
                <span id="favoritesCount" class="text-xs text-gray-500">0</span>
            </div>
            <div id="favoritesList" class="space-y-2">
                <!-- Favorites will be populated by JavaScript -->
            </div>
        </div>

        <!-- Calculation History -->
        <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-medium text-gray-700">Recent</h3>
                <button id="clearHistory" class="text-xs text-gray-500 hover:text-red-500">Clear</button>
            </div>
            <div id="historyList" class="space-y-2">
                <!-- History will be populated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50">
        <span id="toastMessage"></span>
    </div>

    <script>
        // Unit conversion data with all conversion factors to base units
        const unitData = {
            length: {
                name: 'Length',
                units: {
                    // Metric
                    nm: { name: 'Nanometer', symbol: 'nm', factor: 1e-9 },
                    μm: { name: 'Micrometer', symbol: 'μm', factor: 1e-6 },
                    mm: { name: 'Millimeter', symbol: 'mm', factor: 1e-3 },
                    cm: { name: 'Centimeter', symbol: 'cm', factor: 1e-2 },
                    m: { name: 'Meter', symbol: 'm', factor: 1 },
                    km: { name: 'Kilometer', symbol: 'km', factor: 1e3 },
                    Mm: { name: 'Megameter', symbol: 'Mm', factor: 1e6 },
                    
                    // Imperial/US
                    in: { name: 'Inch', symbol: 'in', factor: 0.0254 },
                    ft: { name: 'Foot', symbol: 'ft', factor: 0.3048 },
                    yd: { name: 'Yard', symbol: 'yd', factor: 0.9144 },
                    mi: { name: 'Mile', symbol: 'mi', factor: 1609.344 },
                    
                    // Maritime/Nautical
                    nmi: { name: 'Nautical Mile', symbol: 'nmi', factor: 1852 },
                    
                    // Astronomical
                    au: { name: 'Astronomical Unit', symbol: 'AU', factor: 149597870700 },
                    ly: { name: 'Light Year', symbol: 'ly', factor: 9.461e15 },
                    pc: { name: 'Parsec', symbol: 'pc', factor: 3.086e16 },
                    
                    // Scientific
                    'planck-length': { name: 'Planck Length', symbol: 'ℓₚ', factor: 1.616255e-35 }
                }
            },
            weight: {
                name: 'Weight',
                units: {
                    // Metric
                    mg: { name: 'Milligram', symbol: 'mg', factor: 1e-6 },
                    g: { name: 'Gram', symbol: 'g', factor: 1e-3 },
                    kg: { name: 'Kilogram', symbol: 'kg', factor: 1 },
                    tonne: { name: 'Tonne', symbol: 't', factor: 1000 },
                    
                    // Imperial/US
                    oz: { name: 'Ounce', symbol: 'oz', factor: 0.0283495 },
                    lb: { name: 'Pound', symbol: 'lb', factor: 0.453592 },
                    st: { name: 'Stone', symbol: 'st', factor: 6.35029 },
                    
                    // Cooking
                    tsp: { name: 'Teaspoon', symbol: 'tsp', factor: 0.005 },
                    tbsp: { name: 'Tablespoon', symbol: 'tbsp', factor: 0.015 },
                    cup: { name: 'Cup', symbol: 'cup', factor: 0.24 },
                    
                    // Scientific
                    'planck-mass': { name: 'Planck Mass', symbol: 'mₚ', factor: 2.176e-8 }
                }
            },
            temperature: {
                name: 'Temperature',
                units: {
                    celsius: { name: 'Celsius', symbol: '°C' },
                    fahrenheit: { name: 'Fahrenheit', symbol: '°F' },
                    kelvin: { name: 'Kelvin', symbol: 'K' },
                    rankine: { name: 'Rankine', symbol: '°R' }
                }
            },
            volume: {
                name: 'Volume',
                units: {
                    // Metric
                    ml: { name: 'Milliliter', symbol: 'ml', factor: 1e-6 },
                    l: { name: 'Liter', symbol: 'l', factor: 1e-3 },
                    m3: { name: 'Cubic Meter', symbol: 'm³', factor: 1 },
                    
                    // US Customary
                    floz: { name: 'Fluid Ounce', symbol: 'fl oz', factor: 2.957e-5 },
                    cup: { name: 'Cup', symbol: 'cup', factor: 0.236588 },
                    pt: { name: 'Pint', symbol: 'pt', factor: 0.473176 },
                    qt: { name: 'Quart', symbol: 'qt', factor: 0.946353 },
                    gal: { name: 'Gallon', symbol: 'gal', factor: 3.78541 },
                    
                    // Cooking
                    'fl-tsp': { name: 'Teaspoon (tsp)', symbol: 'tsp', factor: 4.929e-6 },
                    'fl-tbsp': { name: 'Tablespoon (tbsp)', symbol: 'tbsp', factor: 1.479e-5 }
                }
            },
            time: {
                name: 'Time',
                units: {
                    ns: { name: 'Nanosecond', symbol: 'ns', factor: 1e-9 },
                    μs: { name: 'Microsecond', symbol: 'μs', factor: 1e-6 },
                    ms: { name: 'Millisecond', symbol: 'ms', factor: 1e-3 },
                    s: { name: 'Second', symbol: 's', factor: 1 },
                    min: { name: 'Minute', symbol: 'min', factor: 60 },
                    h: { name: 'Hour', symbol: 'h', factor: 3600 },
                    day: { name: 'Day', symbol: 'd', factor: 86400 },
                    week: { name: 'Week', symbol: 'wk', factor: 604800 },
                    month: { name: 'Month', symbol: 'mo', factor: 2629746 },
                    year: { name: 'Year', symbol: 'yr', factor: 31556952 },
                    decade: { name: 'Decade', symbol: 'dec', factor: 315569520 },
                    century: { name: 'Century', symbol: 'c', factor: 3155695200 }
                }
            },
            digital: {
                name: 'Digital',
                units: {
                    b: { name: 'Bit', symbol: 'b', factor: 1/8 },
                    B: { name: 'Byte', symbol: 'B', factor: 1 },
                    KB: { name: 'Kilobyte', symbol: 'KB', factor: 1024 },
                    MB: { name: 'Megabyte', symbol: 'MB', factor: 1024**2 },
                    GB: { name: 'Gigabyte', symbol: 'GB', factor: 1024**3 },
                    TB: { name: 'Terabyte', symbol: 'TB', factor: 1024**4 },
                    PB: { name: 'Petabyte', symbol: 'PB', factor: 1024**5 },
                    KiB: { name: 'Kibibyte', symbol: 'KiB', factor: 1024 },
                    MiB: { name: 'Mebibyte', symbol: 'MiB', factor: 1024**2 },
                    GiB: { name: 'Gibibyte', symbol: 'GiB', factor: 1024**3 },
                    TiB: { name: 'Tebibyte', symbol: 'TiB', factor: 1024**4 },
                    PiB: { name: 'Pebibyte', symbol: 'PiB', factor: 1024**5 }
                }
            },
            scientific: {
                name: 'Scientific',
                units: {
                    // Energy
                    J: { name: 'Joule', symbol: 'J', factor: 1 },
                    kJ: { name: 'Kilojoule', symbol: 'kJ', factor: 1000 },
                    cal: { name: 'Calorie', symbol: 'cal', factor: 4.184 },
                    kcal: { name: 'Kilocalorie', symbol: 'kcal', factor: 4184 },
                    eV: { name: 'Electron Volt', symbol: 'eV', factor: 1.602e-19 },
                    
                    // Power
                    W: { name: 'Watt', symbol: 'W', factor: 1 },
                    kW: { name: 'Kilowatt', symbol: 'kW', factor: 1000 },
                    hp: { name: 'Horsepower', symbol: 'hp', factor: 745.7 },
                    
                    // Pressure
                    Pa: { name: 'Pascal', symbol: 'Pa', factor: 1 },
                    kPa: { name: 'Kilopascal', symbol: 'kPa', factor: 1000 },
                    bar: { name: 'Bar', symbol: 'bar', factor: 100000 },
                    atm: { name: 'Atmosphere', symbol: 'atm', factor: 101325 },
                    psi: { name: 'PSI', symbol: 'psi', factor: 6894.76 },
                    
                    // Speed
                    'm/s': { name: 'Meters per Second', symbol: 'm/s', factor: 1 },
                    'km/h': { name: 'Kilometers per Hour', symbol: 'km/h', factor: 0.277778 },
                    'mph': { name: 'Miles per Hour', symbol: 'mph', factor: 0.44704 },
                    'knot': { name: 'Knot', symbol: 'kn', factor: 0.514444 }
                }
            }
        };

        // App state
        let currentCategory = 'length';
        let favorites = JSON.parse(localStorage.getItem('unitConverterFavorites')) || [];
        let history = JSON.parse(localStorage.getItem('unitConverterHistory')) || [];
        let searchTerm = '';

        // DOM elements
        const fromValueEl = document.getElementById('fromValue');
        const fromUnitEl = document.getElementById('fromUnit');
        const toValueEl = document.getElementById('toValue');
        const toUnitEl = document.getElementById('toUnit');
        const swapBtn = document.getElementById('swapBtn');
        const favoriteBtn = document.getElementById('favoriteBtn');
        const quickCardsEl = document.getElementById('quickCards');
        const favoritesListEl = document.getElementById('favoritesList');
        const historyListEl = document.getElementById('historyList');
        const searchInputEl = document.getElementById('searchInput');
        const shareBtn = document.getElementById('shareBtn');
        const toastEl = document.getElementById('toast');

        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const moonIcon = document.querySelector('.moon-icon');
        const sunIcon = document.querySelector('.sun-icon');

        function initDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true' || 
                          (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches);
            
            if (isDark) {
                document.documentElement.classList.add('dark');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
            }
        }

        function toggleDarkMode() {
            const isDark = document.documentElement.classList.contains('dark');
            
            if (isDark) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('darkMode', 'false');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
                showToast('Light mode activated');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('darkMode', 'true');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
                showToast('Dark mode activated');
            }
        }

        // Initialize app
        function init() {
            initDarkMode();
            setupEventListeners();
            populateUnitSelectors();
            updateQuickCards();
            updateFavoritesList();
            updateHistoryList();
            checkUrlParams();
            convertValue(); // Initial conversion
        }

        // Setup event listeners
        function setupEventListeners() {
            // Dark mode toggle
            darkModeToggle.addEventListener('click', toggleDarkMode);

            // Tab switching
            document.querySelectorAll('.conversion-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const category = e.target.dataset.category;
                    switchCategory(category);
                });
            });

            // Input events
            fromValueEl.addEventListener('input', convertValue);
            fromUnitEl.addEventListener('change', convertValue);
            toUnitEl.addEventListener('change', convertValue);

            // Swap button
            swapBtn.addEventListener('click', swapUnits);

            // Favorite button
            favoriteBtn.addEventListener('click', toggleFavorite);

            // Search
            searchInputEl.addEventListener('input', handleSearch);

            // Share button
            shareBtn.addEventListener('click', shareResult);

            // Clear history
            document.getElementById('clearHistory').addEventListener('click', clearHistory);

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboard);

            // Touch/swipe events for quick cards
            setupSwipeEvents();
        }

        // Setup swipe events for quick cards
        function setupSwipeEvents() {
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            quickCardsEl.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });

            quickCardsEl.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
            });

            quickCardsEl.addEventListener('touchend', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                const threshold = 50;
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0) {
                        // Swipe left - scroll right
                        quickCardsEl.scrollBy({ left: 200, behavior: 'smooth' });
                    } else {
                        // Swipe right - scroll left
                        quickCardsEl.scrollBy({ left: -200, behavior: 'smooth' });
                    }
                }
                
                isDragging = false;
            });
        }

        // Switch conversion category
        function switchCategory(category) {
            currentCategory = category;
            
            // Update tab appearance
            document.querySelectorAll('.conversion-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.category === category);
            });

            populateUnitSelectors();
            updateQuickCards();
            convertValue();
        }

        // Populate unit selectors
        function populateUnitSelectors() {
            const units = unitData[currentCategory].units;
            const unitKeys = Object.keys(units);

            [fromUnitEl, toUnitEl].forEach(select => {
                select.innerHTML = '';
                unitKeys.forEach(key => {
                    const unit = units[key];
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = `${unit.symbol} - ${unit.name}`;
                    select.appendChild(option);
                });
            });

            // Set defaults based on category
            const defaults = {
                length: ['m', 'ft'],
                weight: ['kg', 'lb'],
                temperature: ['celsius', 'fahrenheit'],
                volume: ['l', 'gal'],
                time: ['s', 'min'],
                digital: ['MB', 'GB'],
                scientific: ['J', 'cal']
            };

            fromUnitEl.value = defaults[currentCategory][0];
            toUnitEl.value = defaults[currentCategory][1];
        }

        // Convert value between units
        function convertValue() {
            const fromValue = parseFloat(fromValueEl.value);
            const fromUnit = fromUnitEl.value;
            const toUnit = toUnitEl.value;

            if (isNaN(fromValue)) {
                toValueEl.value = '';
                return;
            }

            let result;
            
            if (currentCategory === 'temperature') {
                result = convertTemperature(fromValue, fromUnit, toUnit);
            } else {
                const fromUnitData = unitData[currentCategory].units[fromUnit];
                const toUnitData = unitData[currentCategory].units[toUnit];
                
                if (fromUnitData.factor && toUnitData.factor) {
                    // Simple factor-based conversion
                    const baseValue = fromValue * fromUnitData.factor;
                    result = baseValue / toUnitData.factor;
                }
            }

            if (result !== undefined) {
                toValueEl.value = formatNumber(result);
                addToHistory(fromValue, fromUnit, result, toUnit);
                updateFavoriteButton();
            }
        }

        // Convert temperature values
        function convertTemperature(value, from, to) {
            let celsius;
            
            // Convert to Celsius first
            switch (from) {
                case 'celsius':
                    celsius = value;
                    break;
                case 'fahrenheit':
                    celsius = (value - 32) * 5/9;
                    break;
                case 'kelvin':
                    celsius = value - 273.15;
                    break;
                case 'rankine':
                    celsius = (value - 491.67) * 5/9;
                    break;
            }

            // Convert from Celsius to target
            switch (to) {
                case 'celsius':
                    return celsius;
                case 'fahrenheit':
                    return celsius * 9/5 + 32;
                case 'kelvin':
                    return celsius + 273.15;
                case 'rankine':
                    return celsius * 9/5 + 491.67;
            }
        }

        // Format number for display
        function formatNumber(num) {
            if (num === 0) return '0';
            if (Math.abs(num) >= 1e-6 && Math.abs(num) < 1e6) {
                return num.toLocaleString(undefined, {
                    maximumFractionDigits: 6,
                    useGrouping: true
                });
            } else {
                return num.toExponential(3);
            }
        }

        // Swap units
        function swapUnits() {
            const fromUnit = fromUnitEl.value;
            const toUnit = toUnitEl.value;
            
            fromUnitEl.value = toUnit;
            toUnitEl.value = fromUnit;
            
            convertValue();
        }

        // Toggle favorite
        function toggleFavorite() {
            const fromUnit = fromUnitEl.value;
            const toUnit = toUnitEl.value;
            const category = currentCategory;
            
            const favorite = { category, fromUnit, toUnit };
            const index = favorites.findIndex(f => 
                f.category === category && 
                f.fromUnit === fromUnit && 
                f.toUnit === toUnit
            );

            if (index === -1) {
                favorites.push(favorite);
                showToast('Added to favorites!');
            } else {
                favorites.splice(index, 1);
                showToast('Removed from favorites!');
            }

            localStorage.setItem('unitConverterFavorites', JSON.stringify(favorites));
            updateFavoriteButton();
            updateFavoritesList();
        }

        // Update favorite button state
        function updateFavoriteButton() {
            const fromUnit = fromUnitEl.value;
            const toUnit = toUnitEl.value;
            const category = currentCategory;
            
            const isFavorite = favorites.some(f => 
                f.category === category && 
                f.fromUnit === fromUnit && 
                f.toUnit === toUnit
            );

            favoriteBtn.classList.toggle('active', isFavorite);
        }

        // Add to history
        function addToHistory(fromValue, fromUnit, result, toUnit) {
            const historyItem = {
                category: currentCategory,
                fromValue,
                fromUnit,
                result,
                toUnit,
                timestamp: Date.now()
            };

            history.unshift(historyItem);
            
            // Keep only last 10 items
            if (history.length > 10) {
                history = history.slice(0, 10);
            }

            localStorage.setItem('unitConverterHistory', JSON.stringify(history));
            updateHistoryList();
        }

        // Update quick conversion cards
        function updateQuickCards() {
            quickCardsEl.innerHTML = '';
            
            const units = unitData[currentCategory].units;
            const unitKeys = Object.keys(units);
            
            // Most common conversions for each category
            const commonPairs = {
                length: [['m', 'ft'], ['km', 'mi'], ['cm', 'in']],
                weight: [['kg', 'lb'], ['g', 'oz'], ['tonne', 'lb']],
                temperature: [['celsius', 'fahrenheit'], ['celsius', 'kelvin'], ['fahrenheit', 'kelvin']],
                volume: [['l', 'gal'], ['ml', 'floz'], ['cup', 'ml']],
                time: [['s', 'min'], ['min', 'h'], ['h', 'day']],
                digital: [['MB', 'GB'], ['GB', 'TB'], ['MiB', 'GiB']],
                scientific: [['J', 'kJ'], ['kPa', 'psi'], ['m/s', 'km/h']]
            };

            const pairs = commonPairs[currentCategory] || [];
            
            pairs.forEach(([fromUnit, toUnit]) => {
                if (units[fromUnit] && units[toUnit]) {
                    const card = createQuickCard(units[fromUnit], units[toUnit]);
                    quickCardsEl.appendChild(card);
                }
            });
        }

        // Create quick conversion card
        function createQuickCard(fromUnit, toUnit) {
            const card = document.createElement('div');
            card.className = 'unit-card bg-white rounded-lg p-3 min-w-0 flex-shrink-0 cursor-pointer border border-gray-200';
            
            card.innerHTML = `
                <div class="text-xs text-gray-500 mb-1">${fromUnit.symbol} → ${toUnit.symbol}</div>
                <div class="font-medium text-gray-800 text-sm">${fromUnit.name} to ${toUnit.name}</div>
            `;
            
            card.addEventListener('click', () => {
                fromUnitEl.value = Object.keys(unitData[currentCategory].units).find(key => 
                    unitData[currentCategory].units[key].symbol === fromUnit.symbol
                );
                toUnitEl.value = Object.keys(unitData[currentCategory].units).find(key => 
                    unitData[currentCategory].units[key].symbol === toUnit.symbol
                );
                convertValue();
            });
            
            return card;
        }

        // Update favorites list
        function updateFavoritesList() {
            const favoritesCount = document.getElementById('favoritesCount');
            favoritesCount.textContent = favorites.length;
            
            favoritesListEl.innerHTML = '';
            
            if (favorites.length === 0) {
                favoritesListEl.innerHTML = '<div class="text-gray-400 text-sm text-center py-4">No favorites yet</div>';
                return;
            }

            favorites.forEach((fav, index) => {
                const unit = unitData[fav.category].units[fav.fromUnit];
                const toUnit = unitData[fav.category].units[fav.toUnit];
                
                const item = document.createElement('div');
                item.className = 'unit-card bg-white rounded-lg p-3 border border-gray-200 flex items-center justify-between';
                
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-800">${unit.symbol} → ${toUnit.symbol}</div>
                        <div class="text-xs text-gray-500">${unitData[fav.category].name}</div>
                    </div>
                    <button class="text-gray-400 hover:text-red-500 p-1" onclick="removeFavorite(${index})">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('button')) {
                        switchCategory(fav.category);
                        fromUnitEl.value = fav.fromUnit;
                        toUnitEl.value = fav.toUnit;
                        convertValue();
                    }
                });
                
                favoritesListEl.appendChild(item);
            });
        }

        // Remove favorite
        function removeFavorite(index) {
            favorites.splice(index, 1);
            localStorage.setItem('unitConverterFavorites', JSON.stringify(favorites));
            updateFavoritesList();
            updateFavoriteButton();
        }

        // Update history list
        function updateHistoryList() {
            historyListEl.innerHTML = '';
            
            if (history.length === 0) {
                historyListEl.innerHTML = '<div class="text-gray-400 text-sm text-center py-4">No recent conversions</div>';
                return;
            }

            history.forEach(item => {
                const fromUnit = unitData[item.category].units[item.fromUnit];
                const toUnit = unitData[item.category].units[item.toUnit];
                
                const timeAgo = getTimeAgo(item.timestamp);
                
                const itemEl = document.createElement('div');
                itemEl.className = 'unit-card bg-white rounded-lg p-3 border border-gray-200 cursor-pointer';
                
                itemEl.innerHTML = `
                    <div class="text-sm font-medium text-gray-800">
                        ${formatNumber(item.fromValue)} ${fromUnit.symbol} → ${formatNumber(item.result)} ${toUnit.symbol}
                    </div>
                    <div class="text-xs text-gray-500">${unitData[item.category].name} • ${timeAgo}</div>
                `;
                
                itemEl.addEventListener('click', () => {
                    switchCategory(item.category);
                    fromUnitEl.value = item.fromUnit;
                    toUnitEl.value = item.toUnit;
                    fromValueEl.value = item.fromValue;
                    convertValue();
                });
                
                historyListEl.appendChild(itemEl);
            });
        }

        // Get time ago string
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        // Handle search
        function handleSearch(e) {
            searchTerm = e.target.value.toLowerCase();
            filterUnits();
        }

        // Filter units based on search
        function filterUnits() {
            const units = unitData[currentCategory].units;
            
            [fromUnitEl, toUnitEl].forEach((select) => {
                // Store current selection
                const currentValue = select.value;
                
                // Clear and rebuild options with filtering
                select.innerHTML = '';
                let optionCount = 0;
                
                Object.keys(units).forEach(key => {
                    const unit = units[key];
                    const searchText = `${unit.name} ${unit.symbol}`.toLowerCase();
                    const keyLower = key.toLowerCase();
                    
                    // Search in name, symbol, and key - with better matching
                    if (searchTerm === '' || 
                        searchText.includes(searchTerm) || 
                        keyLower.includes(searchTerm) ||
                        unit.symbol.toLowerCase().includes(searchTerm) ||
                        unit.name.toLowerCase().includes(searchTerm)) {
                        
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = `${unit.symbol} - ${unit.name}`;
                        select.appendChild(option);
                        optionCount++;
                    }
                });
                
                // If no options were added (empty search), show all units
                if (optionCount === 0 && searchTerm !== '') {
                    Object.keys(units).forEach(key => {
                        const unit = units[key];
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = `${unit.symbol} - ${unit.name}`;
                        select.appendChild(option);
                    });
                }
                
                // Restore selection if still available
                if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                    select.value = currentValue;
                } else if (select.options.length > 0) {
                    select.selectedIndex = 0;
                }
            });
        }

        // Share result
        function shareResult() {
            const fromValue = fromValueEl.value;
            const fromUnit = fromUnitEl.value;
            const toUnit = toUnitEl.value;
            
            if (!fromValue) {
                showToast('Enter a value to share');
                return;
            }
            
            const url = new URL(window.location);
            url.searchParams.set('from', fromValue);
            url.searchParams.set('fromUnit', fromUnit);
            url.searchParams.set('toUnit', toUnit);
            url.searchParams.set('category', currentCategory);
            
            if (navigator.share) {
                navigator.share({
                    title: 'Unit Conversion Result',
                    text: `${fromValue} ${unitData[currentCategory].units[fromUnit].symbol} = ${toValueEl.value} ${unitData[currentCategory].units[toUnit].symbol}`,
                    url: url.toString()
                });
            } else {
                navigator.clipboard.writeText(url.toString()).then(() => {
                    showToast('Link copied to clipboard!');
                });
            }
        }

        // Check URL parameters
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const fromValue = params.get('from');
            const fromUnit = params.get('fromUnit');
            const toUnit = params.get('toUnit');
            const category = params.get('category');
            
            if (category && unitData[category]) {
                switchCategory(category);
            }
            
            if (fromUnit && toUnit && unitData[currentCategory].units[fromUnit] && unitData[currentCategory].units[toUnit]) {
                fromUnitEl.value = fromUnit;
                toUnitEl.value = toUnit;
            }
            
            if (fromValue) {
                fromValueEl.value = fromValue;
                convertValue();
            }
        }

        // Clear history
        function clearHistory() {
            history = [];
            localStorage.setItem('unitConverterHistory', JSON.stringify(history));
            updateHistoryList();
            showToast('History cleared');
        }

        // Handle keyboard shortcuts
        function handleKeyboard(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        shareResult();
                        break;
                    case 'f':
                        e.preventDefault();
                        toggleFavorite();
                        break;
                }
            }
        }

        // Show toast notification
        function showToast(message) {
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            
            toastEl.style.opacity = '1';
            
            setTimeout(() => {
                toastEl.style.opacity = '0';
            }, 3000);
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
